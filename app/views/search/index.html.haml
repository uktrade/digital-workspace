/= render partial: "widgets/zendesk_header"
%div{:id => 'page', :class => 'page-content'}
  - if @string.nil?
    %main#content.search-results
      .grid-row
        .column-full
          %h2.heading-medium
            Search by using the dialog box above
  - else 
    %main#content.search-results
      .grid-row
        .column-full
          %h2.heading-medium
            Search results for '#{@string}'
      .grid-row
        .column-third
          %p.info
            Filter by:
          = render partial: "widgets/search_filter_types"
          = render partial: "widgets/search_filter_news_views"
          = render partial: "widgets/search_filter_working_at_dit"
          = form_tag('/search', id: 'filter-search', method: 'GET')
          = hidden_field_tag('s', @string)
          = hidden_field_tag('filter_types')
          = hidden_field_tag('filter_news')
          = hidden_field_tag('filter_themes')
          .submit.js-live-search-fallback
            = submit_tag('Submit filters', class: 'button')
        .column-two-thirds
          - if !@posts.nil?
            .result-count
              - @headers.to_json
              = "#{@headers['x-wp-total']} results found"
            %ol.results-list
              - @posts.each do |p|
                - date = DateTime.parse(p['date_gmt'])
                - formatted_date = date.strftime('%e %b %Y')
                - formatted_time = date.strftime('%H:%M')
                - if p['type'] == 'news'
                  - (top_level_slug = link_to('News', '/news-and-views/'))
                  - if p['news_categories']
                    - category_slug = ' > ' + link_to(p['news_categories'][0]['name'], '/news-and-views/category/' + p['news_categories'][0]['slug'])
                - elsif p['type'] == 'policy'
                  - top_level_slug = link_to('Policies and Guidance', '/working-at-dit/')
                  - category_slug = ''
                - elsif p['type'] == 'howdoi'
                  - top_level_slug = link_to('How Do I?', '/working-at-dit/')
                  - if p['topic_taxonomy']
                    - category_slug = ' > ' + link_to(p['topic_taxonomy'][0]['name'], '/working-at-dit/' + p['topic_taxonomy'][0]['slug'])
                -else
                  - top_level_slug = ''
                  - category_slug = ''
                %li.search-result
                  %h3.heading-medium
                    %a{:href => p['mapped_path']}
                      = p['title']
                  %span.search-meta
                    = "#{formatted_date} @ #{formatted_time} GMT in #{top_level_slug} #{category_slug}".html_safe
                  %p.content
                    = p['excerpt'].html_safe
            = render partial: "widgets/search_pagination"
  
= render partial: "widgets/zendesk_footer"
